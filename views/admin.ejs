<!DOCTYPE html>
  <head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tech Blog Web Scraper</title>
	<link href="/css/bootstrap/bootstrap.min.css" rel="stylesheet"/>
	<link href="/css/tui-chart/tui-chart.min.css" rel="stylesheet"/>
	<link href="/css/style.css" rel="stylesheet"/>
	<style>
		.menu {
			display: none;
			height: 50%;
		}
		.menu-area {
			width: 100%;
			height: 50%;
			padding: 20px;
		}
		.submit-btn {
			width: 100px;
			height: 50px;
		}
	</style>
  </head>
  <body>
	<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
		<!--logo-->
		<a class="navbar-brand" href="#">Admin</a>
		<ul class="navbar-nav">
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">통계</a>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="#" onClick="loadMenu(event, 'menu_visitors')">일일 방문자 수</a>
					<a class="dropdown-item" href="#" onClick="loadMenu(event, 'menu_post_views')">포스트별 조회수 순위</a>
				</div>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#" onClick="logout();"><strong>Logout</strong></a>
			</li>
		</ul>
	</nav>
	<div class="container">
		<h1 class="text-centered title"><strong>&#128240;Tech Blog Web Scraper - Admin</strong></h1>
		<div class="menues-wrapper">
			<!-- 일일 방문자 수 -->
			<div class="menu" id="menu_visitors">
				<h4 class="menu-title"><strong>일일 방문자 수</strong></h4>
				<div class="card shadow component menu-area">
					<div id="chart-area"></div>
					<button class="btn btn-primary" onClick="requestVisitors();">조회</button>
				</div>
			</div>
			<!-- 포스트별 조회수 순위 -->
			<div class="menu" id="menu_post_views">
				<h4 class="menu-title"><strong>포스트별 조회수 순위</strong></h4>
				<div class="card shadow component menu-area">
					post chart
				</div>
			</div>
		</div>
		<button id="theme_btn" class="btn btn-dark" onClick="switchTheme(this.classList[1].split('-')[1])">다크 모드로 보기</button>
	</div>

	<script type="text/javascript" src="/js/theme.js"></script>
	<script type="text/javascript" src="/js/jquery/jquery.js"></script>
	<script type="text/javascript" src="/js/bootstrap/bootstrap.bundle.min.js"></script>
	<!--<script type="text/javascript" src="https://uicdn.toast.com/tui.chart/latest/raphael.js"></script>-->
	<script type="text/javascript" src="/js/raphael/raphael.min.js"></script>
	<script type="text/javascript" src="/js/tui-chart/tui-chart.min.js"></script>
	<script>
		var loadChart = function(inpData) {
			var container = document.getElementById("chart-area");
			container.innerHTML = "";
			var data = {
				categories: ['01/01/2016', '02/01/2016', '03/01/2016', '04/01/2016', '05/01/2016', '06/01/2016', '07/01/2016', '08/01/2016', '09/01/2016', '10/01/2016', '11/01/2016', '12/01/2016'],
				series: [
					{
						name: 'Seoul',
						data: [-3.5, -1.1, 4.0, 11.3, 17.5, 21.5, 24.9, 25.2, 20.4, 13.9, 6.6, -0.6]
					},
					{
						name: 'Seattle',
						data: [3.8, 5.6, 7.0, 9.1, 12.4, 15.3, 17.5, 17.8, 15.0, 10.6, 6.4, 3.7]
					},
					{
						name: 'Sydney',
						data: [22.1, 22.0, 20.9, 18.3, 15.2, 12.8, 11.8, 13.0, 15.2, 17.6, 19.4, 21.2]
					},
					{
						name: 'Moskva',
						data: [-10.3, -9.1, -4.1, 4.4, 12.2, 16.3, 18.5, 16.7, 10.9, 4.2, -2.0, -7.5]
					},
					{
						name: 'Jungfrau',
						data: [-13.2, -13.7, -13.1, -10.3, -6.1, -3.2, 0.0, -0.1, -1.8, -4.5, -9.0, -10.9]
					}
				]
			};
			var options = {
				chart: {
					width: 1160,
					height: 540,
					title: '24-hr Average Temperature'
				},
				yAxis: {
					title: 'Temperature (Celsius)',
				},
				xAxis: {
					title: 'Month',
					pointOnColumn: true,
					dateFormat: 'MMM',
					tickInterval: 'auto'
				},
				series: {
					showDot: false,
					zoomable: true
				},
				tooltip: {
					suffix: '°C'
				},
				plot: {
					bands: [
						{
							range: ['03/01/2016', '05/01/2016'],
							color: 'gray',
							opacity: 0.2
						}
					],
					lines: [
						{
							value: '03/01/2016',
							color: '#fa2828'
						}
					]
				}
			};
			var theme = {
				series: {
					colors: [
						'#83b14e', '#458a3f', '#295ba0', '#2a4175', '#289399',
						'#289399', '#617178', '#8a9a9a', '#516f7d', '#dddddd'
					]
				}
			};
			// For apply theme
			// tui.chart.registerTheme('myTheme', theme);
			// options.theme = 'myTheme';
			var chart = tui.chart.lineChart(container, data, options);
		};

		var requestVisitors = function() {
			$.ajax({
				type: "post",
				url: "/statistics/visit",
				data: {},
				success: function(result) {
					console.log(result.data);
					loadChart(result.data);
					//chartTest();
				},
				error: function(xhr, textStatus, errorThrown) {
					alert("request failed.\n" + xhr.status + " " + xhr.statusText);
				}
			})
		};

		var loadMenu = function(event, menuName) {
			var menues = document.getElementsByClassName("menu");
			for(var i = 0; i < menues.length; ++i) {
				if(menues[i].getAttribute("id") == menuName) {
					menues[i].style.display = "block";
				} else {
					menues[i].style.display = "none";
				}
			}
		};

		//onload event
		document.addEventListener("DOMContentLoaded", function() {
			switchTheme(window.localStorage.theme);
			loadMenu(event, 'menu_visitors');
			
		});
		var logout = function() {
			$.ajax({
				type: "post",
				url: "/adminLogout",
				data: {},
				success: function(result) {
					alert("logout success");
					window.location = "/admin";
					console.log(result.data);
                },
                error : function(xhr, textStatus, errorThrown) {
                  alert("logout failed.\n" + xhr.status + " " + xhr.statusText);
                }
			});
		};
	</script>
	
  </body>
</html>